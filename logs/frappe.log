2023-12-05 13:10:08,666 ERROR frappe Failed to run after request hook
Site: library.test
Form Dict: {}
Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 644, in connect
    sock = socket.create_connection(
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 845, in create_connection
    raise err
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 833, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 95, in application
    init_request(request)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 191, in init_request
    frappe.local.http_request = HTTPRequest()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/auth.py", line 40, in __init__
    self.set_session()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/auth.py", line 76, in set_session
    frappe.local.login_manager = LoginManager()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/auth.py", line 120, in __init__
    self.make_session(resume=True)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/auth.py", line 208, in make_session
    frappe.local.session_obj = Session(
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/sessions.py", line 214, in __init__
    self.resume()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/sessions.py", line 285, in resume
    validate_ip_address(self.user)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/auth.py", line 419, in validate_ip_address
    frappe.get_cached_value("User", user, user_fields, as_dict=True)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1218, in get_cached_value
    doc = get_cached_doc(doctype, name)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1159, in get_cached_doc
    doc = get_doc(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1287, in get_doc
    doc = frappe.model.document.get_doc(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/document.py", line 80, in get_doc
    controller = get_controller(doctype)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/base_document.py", line 66, in get_controller
    return import_controller(doctype)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/base_document.py", line 81, in import_controller
    doctype_info = frappe.db.get_value("DocType", doctype, fieldname="*")
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 466, in get_value
    result = self.get_values(
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 563, in get_values
    out = self._get_values_from_table(
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 827, in _get_values_from_table
    return query.run(as_dict=as_dict, debug=debug, update=update, run=run, pluck=pluck)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/query_builder/utils.py", line 87, in execute_query
    result = frappe.db.sql(query, params, *args, **kwargs)  # nosemgrep
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 194, in sql
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 107, in connect
    self._conn = self.get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 102, in get_connection
    conn = self._get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 108, in _get_connection
    return self.create_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 111, in create_connection
    return pymysql.connect(**self.get_connection_settings())
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 358, in __init__
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 711, in connect
    raise exc
pymysql.err.OperationalError: (2003, "Can't connect to MySQL server on '127.0.0.1' ([Errno 111] Connection refused)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 644, in connect
    sock = socket.create_connection(
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 845, in create_connection
    raise err
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 833, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 128, in application
    response = handle_exception(e)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 320, in handle_exception
    allow_traceback = frappe.get_system_settings("allow_error_traceback") if frappe.db else False
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 2325, in get_system_settings
    local.system_settings = get_cached_doc("System Settings")
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1159, in get_cached_doc
    doc = get_doc(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1287, in get_doc
    doc = frappe.model.document.get_doc(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/document.py", line 80, in get_doc
    controller = get_controller(doctype)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/base_document.py", line 66, in get_controller
    return import_controller(doctype)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/base_document.py", line 81, in import_controller
    doctype_info = frappe.db.get_value("DocType", doctype, fieldname="*")
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 466, in get_value
    result = self.get_values(
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 563, in get_values
    out = self._get_values_from_table(
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 827, in _get_values_from_table
    return query.run(as_dict=as_dict, debug=debug, update=update, run=run, pluck=pluck)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/query_builder/utils.py", line 87, in execute_query
    result = frappe.db.sql(query, params, *args, **kwargs)  # nosemgrep
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 194, in sql
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 107, in connect
    self._conn = self.get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 102, in get_connection
    conn = self._get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 108, in _get_connection
    return self.create_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 111, in create_connection
    return pymysql.connect(**self.get_connection_settings())
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 358, in __init__
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 711, in connect
    raise exc
pymysql.err.OperationalError: (2003, "Can't connect to MySQL server on '127.0.0.1' ([Errno 111] Connection refused)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/caching.py", line 57, in wrapper
    return frappe.local.request_cache[func][args_key]
KeyError: 5740354900026072187

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/caching.py", line 57, in wrapper
    return frappe.local.request_cache[func][args_key]
KeyError: 8893509269020996949

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 644, in connect
    sock = socket.create_connection(
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 845, in create_connection
    raise err
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 833, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 142, in application
    run_after_request_hooks(request, response)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 157, in run_after_request_hooks
    for after_request_task in frappe.get_hooks("after_request"):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1597, in get_hooks
    hooks = _dict(cache.get_value("app_hooks", _load_app_hooks))
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/redis_wrapper.py", line 100, in get_value
    val = generator()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/caching.py", line 59, in wrapper
    return_val = func(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1560, in _load_app_hooks
    apps = [app_name] if app_name else get_installed_apps(_ensure_on_bench=True)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/caching.py", line 59, in wrapper
    return_val = func(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1529, in get_installed_apps
    installed = json.loads(db.get_global("installed_apps") or "[]")
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 930, in get_global
    return self.get_default(key, user)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 934, in get_default
    d = self.get_defaults(key, parent)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 950, in get_defaults
    defaults = frappe.defaults.get_defaults_for(parent)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/defaults.py", line 236, in get_defaults_for
    frappe.qb.from_(table)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/query_builder/utils.py", line 87, in execute_query
    result = frappe.db.sql(query, params, *args, **kwargs)  # nosemgrep
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 194, in sql
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 107, in connect
    self._conn = self.get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 102, in get_connection
    conn = self._get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 108, in _get_connection
    return self.create_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 111, in create_connection
    return pymysql.connect(**self.get_connection_settings())
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 358, in __init__
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 711, in connect
    raise exc
pymysql.err.OperationalError: (2003, "Can't connect to MySQL server on '127.0.0.1' ([Errno 111] Connection refused)")
2023-12-06 11:09:14,691 ERROR frappe Failed to run after request hook
Site: library.test
Form Dict: {}
Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 644, in connect
    sock = socket.create_connection(
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 845, in create_connection
    raise err
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 833, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 95, in application
    init_request(request)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 191, in init_request
    frappe.local.http_request = HTTPRequest()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/auth.py", line 40, in __init__
    self.set_session()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/auth.py", line 76, in set_session
    frappe.local.login_manager = LoginManager()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/auth.py", line 120, in __init__
    self.make_session(resume=True)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/auth.py", line 208, in make_session
    frappe.local.session_obj = Session(
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/sessions.py", line 214, in __init__
    self.resume()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/sessions.py", line 280, in resume
    data = self.get_session_record()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/sessions.py", line 297, in get_session_record
    r = self.get_session_data()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/sessions.py", line 313, in get_session_data
    data = self.get_session_data_from_db()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/sessions.py", line 341, in get_session_data_from_db
    .where(sessions.lastupdate > get_expired_threshold())
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/sessions.py", line 418, in get_expired_threshold
    now = frappe.utils.now()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/data.py", line 353, in now
    return now_datetime().strftime(DATETIME_FORMAT)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/data.py", line 299, in now_datetime
    dt = convert_utc_to_system_timezone(datetime.datetime.now(pytz.UTC))
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/data.py", line 340, in convert_utc_to_system_timezone
    time_zone = get_system_timezone()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/data.py", line 320, in get_system_timezone
    return frappe.cache.get_value("time_zone", _get_system_timezone)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/redis_wrapper.py", line 100, in get_value
    val = generator()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/data.py", line 313, in _get_system_timezone
    return frappe.get_system_settings("time_zone") or "Asia/Kolkata"  # Default to India ?!
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 2325, in get_system_settings
    local.system_settings = get_cached_doc("System Settings")
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1159, in get_cached_doc
    doc = get_doc(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1287, in get_doc
    doc = frappe.model.document.get_doc(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/document.py", line 80, in get_doc
    controller = get_controller(doctype)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/base_document.py", line 66, in get_controller
    return import_controller(doctype)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/base_document.py", line 81, in import_controller
    doctype_info = frappe.db.get_value("DocType", doctype, fieldname="*")
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 466, in get_value
    result = self.get_values(
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 563, in get_values
    out = self._get_values_from_table(
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 827, in _get_values_from_table
    return query.run(as_dict=as_dict, debug=debug, update=update, run=run, pluck=pluck)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/query_builder/utils.py", line 87, in execute_query
    result = frappe.db.sql(query, params, *args, **kwargs)  # nosemgrep
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 194, in sql
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 107, in connect
    self._conn = self.get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 102, in get_connection
    conn = self._get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 108, in _get_connection
    return self.create_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 111, in create_connection
    return pymysql.connect(**self.get_connection_settings())
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 358, in __init__
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 711, in connect
    raise exc
pymysql.err.OperationalError: (2003, "Can't connect to MySQL server on '127.0.0.1' ([Errno 111] Connection refused)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 644, in connect
    sock = socket.create_connection(
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 845, in create_connection
    raise err
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 833, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 128, in application
    response = handle_exception(e)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 320, in handle_exception
    allow_traceback = frappe.get_system_settings("allow_error_traceback") if frappe.db else False
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 2325, in get_system_settings
    local.system_settings = get_cached_doc("System Settings")
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1159, in get_cached_doc
    doc = get_doc(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1287, in get_doc
    doc = frappe.model.document.get_doc(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/document.py", line 80, in get_doc
    controller = get_controller(doctype)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/base_document.py", line 66, in get_controller
    return import_controller(doctype)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/model/base_document.py", line 81, in import_controller
    doctype_info = frappe.db.get_value("DocType", doctype, fieldname="*")
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 466, in get_value
    result = self.get_values(
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 563, in get_values
    out = self._get_values_from_table(
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 827, in _get_values_from_table
    return query.run(as_dict=as_dict, debug=debug, update=update, run=run, pluck=pluck)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/query_builder/utils.py", line 87, in execute_query
    result = frappe.db.sql(query, params, *args, **kwargs)  # nosemgrep
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 194, in sql
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 107, in connect
    self._conn = self.get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 102, in get_connection
    conn = self._get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 108, in _get_connection
    return self.create_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 111, in create_connection
    return pymysql.connect(**self.get_connection_settings())
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 358, in __init__
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 711, in connect
    raise exc
pymysql.err.OperationalError: (2003, "Can't connect to MySQL server on '127.0.0.1' ([Errno 111] Connection refused)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/caching.py", line 57, in wrapper
    return frappe.local.request_cache[func][args_key]
KeyError: 5740354900026072187

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/caching.py", line 57, in wrapper
    return frappe.local.request_cache[func][args_key]
KeyError: -3614303650551499278

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 644, in connect
    sock = socket.create_connection(
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 845, in create_connection
    raise err
  File "/home/its_pt/.pyenv/versions/3.10.11/lib/python3.10/socket.py", line 833, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 142, in application
    run_after_request_hooks(request, response)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/app.py", line 157, in run_after_request_hooks
    for after_request_task in frappe.get_hooks("after_request"):
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1595, in get_hooks
    hooks = _dict(_load_app_hooks())
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/caching.py", line 59, in wrapper
    return_val = func(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1560, in _load_app_hooks
    apps = [app_name] if app_name else get_installed_apps(_ensure_on_bench=True)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/utils/caching.py", line 59, in wrapper
    return_val = func(*args, **kwargs)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/__init__.py", line 1529, in get_installed_apps
    installed = json.loads(db.get_global("installed_apps") or "[]")
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 930, in get_global
    return self.get_default(key, user)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 934, in get_default
    d = self.get_defaults(key, parent)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 950, in get_defaults
    defaults = frappe.defaults.get_defaults_for(parent)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/defaults.py", line 236, in get_defaults_for
    frappe.qb.from_(table)
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/query_builder/utils.py", line 87, in execute_query
    result = frappe.db.sql(query, params, *args, **kwargs)  # nosemgrep
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 194, in sql
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/database.py", line 107, in connect
    self._conn = self.get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 102, in get_connection
    conn = self._get_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 108, in _get_connection
    return self.create_connection()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/apps/frappe/frappe/database/mariadb/database.py", line 111, in create_connection
    return pymysql.connect(**self.get_connection_settings())
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 358, in __init__
    self.connect()
  File "/home/its_pt/Work/frappe_learn/frappe-bench/env/lib/python3.10/site-packages/pymysql/connections.py", line 711, in connect
    raise exc
pymysql.err.OperationalError: (2003, "Can't connect to MySQL server on '127.0.0.1' ([Errno 111] Connection refused)")
2023-12-06 17:29:30,022 ERROR frappe New Exception collected in error log
Site: library.test
Form Dict: {'doc': '{"name":"LMS00001-4","owner":"Administrator","creation":"2023-12-06 17:27:51.850688","modified":"2023-12-06 17:27:51.850688","modified_by":"Administrator","docstatus":0,"idx":0,"library_member":"huihui@gmail.com","full_name":"haha hehe","from_date":"2022-12-01","to_date":"2024-01-01","paid":1,"amended_from":"LMS00001-3","doctype":"Library Membership","__last_sync_on":"2023-12-06T11:57:51.920Z"}', 'action': 'Submit', 'cmd': 'frappe.desk.form.save.savedocs'}
2023-12-06 17:29:47,157 ERROR frappe New Exception collected in error log
Site: library.test
Form Dict: {'doc': '{"name":"LMS00001-4","owner":"Administrator","creation":"2023-12-06 17:27:51.850688","modified":"2023-12-06 17:27:51.850688","modified_by":"Administrator","docstatus":0,"idx":0,"library_member":"huihui@gmail.com","full_name":"haha hehe","from_date":"2022-12-01","to_date":"2024-01-01","paid":1,"amended_from":"LMS00001-3","doctype":"Library Membership","__last_sync_on":"2023-12-06T11:57:51.920Z"}', 'action': 'Submit', 'cmd': 'frappe.desk.form.save.savedocs'}
